<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ExamRoute ‚Äì Results</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
<nav class="navbar">
    <div class="nav-logo">ExamRoute</div>
    <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="#">Add Info</a></li>
        <li><a href="#">About</a></li>
    </ul>
</nav>

<!-- MAIN RESULT PAGE WRAPPER -->
<div class="result-page">

    <div class="result-container">

        <!-- 1. Exam Info -->
        <div class="exam-info-card">
            <h2 id="examCentreTitle">Loading...</h2>
            <p id="examCityTitle"></p>
        </div>

        <!-- 2. Map -->
        <div class="map-card">
            <h3>üìç Exam Centre Location</h3>
            <div id="map"></div>
            <a id="googleMapBtn" href="#" target="_blank" class="map-btn" >üìçView on Google Maps</a>
        </div>

        <!-- 3. Nearby Stays -->
        <div class="info-card stays-card">
            <h3>üè® Nearby PG / Hostels / Hotels</h3>
            <div id="stayResults">Loading stay info...</div>
        </div>

        <!-- 4. Travel Guide -->
        <div class="info-card travel-card">
            <h3>üöå Travel Guide</h3>
            <div id="travelResults">Loading travel info...</div>
        </div>

    </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDam8hDxPIK32eA_d6x2HUsryfGcYGEEso",
    authDomain: "examroute-2c382.firebaseapp.com",
    projectId: "examroute-2c382",
    storageBucket: "examroute-2c382.appspot.com",
    messagingSenderId: "9052235272",
    appId: "1:9052235272:web:ea06ccdb07a8a6ed093bd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Get URL params
const params = new URLSearchParams(window.location.search);
const city = params.get("city");
const centre = params.get("centre");

// Show header info
document.getElementById("examCentreTitle").innerText = centre;
document.getElementById("examCityTitle").innerText = "City: " + city;


// ================= MAP =================
async function loadMap() {
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${centre}, ${city}`;
    const res = await fetch(url);
    const data = await res.json();

    if (data.length === 0) {
        alert("Location not found on map");
        return;
    }

    const lat = data[0].lat;
    const lon = data[0].lon;

    const map = L.map("map").setView([lat, lon], 15);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap"
    }).addTo(map);

    L.marker([lat, lon]).addTo(map)
        .bindPopup(centre)
        .openPopup();
}


// ================= STAYS =================
async function loadStays() {
    const stayDiv = document.getElementById("stayResults");

    const q = query(
        collection(db, "stays"),
        where("city", "==", city)
    );

    const snapshot = await getDocs(q);

    if (snapshot.empty) {
        stayDiv.innerHTML = "<p>No nearby stays found.</p>";
        return;
    }

    let html = "";
    snapshot.forEach(doc => {
        const d = doc.data();

       html += `
  <div class="stay-card">
      <div class="stay-header">
          <h4>${d.name}</h4>
          <span class="stay-badge">${d.type}</span>
      </div>

      <div class="stay-row">üìç <span>${d.distance}</span></div>
      <div class="stay-row">üí∞ <span>‚Çπ${d.price}/day</span></div>
      <div class="stay-row">üìû <span>${d.phone || "Not available"}</span></div>
  </div>
`;
    });

    stayDiv.innerHTML = html;
}


// ================= TRAVEL =================
async function loadTravel() {
    const travelDiv = document.getElementById("travelResults");

    const q = query(
        collection(db, "travel_guides"),
        where("city", "==", city)
    );

    const snapshot = await getDocs(q);

    if (snapshot.empty) {
        travelDiv.innerHTML = "<p>No travel guide available.</p>";
        return;
    }

    let html = "";
    snapshot.forEach(doc => {
        const d = doc.data();

        html += `
  <div class="travel-card-ui">
      <div class="travel-row"><strong>From:</strong> ${d.from}</div>
      <div class="travel-row"><strong>To:</strong> ${d.to}</div>
      <div class="travel-row"><strong>Mode:</strong> ${d.mode}</div>
      <div class="travel-row"><strong>Details:</strong> ${d.details}</div>
  </div>
`;
    });

    travelDiv.innerHTML = html;
}

loadMap();
loadStays();
loadTravel();

</script>

</body>
</html>